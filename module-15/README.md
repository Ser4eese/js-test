# –ú–æ–¥—É–ª—å 15: Promises

## üéØ –¶–µ–ª—å –º–æ–¥—É–ª—è

–ù–∞—É—á–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Promises ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –∫–æ–¥–æ–º.

---

## üìö –¢–µ–æ—Ä–∏—è

### –ß—Ç–æ —Ç–∞–∫–æ–µ Promise?

**Promise** (–æ–±–µ—â–∞–Ω–∏–µ) ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏. Promise –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ç—Ä—ë—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   PENDING   ‚îÇ  ‚Üê –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–æ–∂–∏–¥–∞–Ω–∏–µ)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚ñº                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FULFILLED  ‚îÇ    ‚îÇ  REJECTED   ‚îÇ
‚îÇ   (—É—Å–ø–µ—Ö)   ‚îÇ    ‚îÇ  (–æ—à–∏–±–∫–∞)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°–æ–∑–¥–∞–Ω–∏–µ Promise

```javascript
const promise = new Promise((resolve, reject) => {
  // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è

  if (/* —É—Å–ø–µ—Ö */) {
    resolve('–†–µ–∑—É–ª—å—Ç–∞—Ç');  // –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ FULFILLED
  } else {
    reject(new Error('–û—à–∏–±–∫–∞'));  // –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ REJECTED
  }
});
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Promise: then/catch

```javascript
promise
  .then(result => {
    console.log('–£—Å–ø–µ—Ö:', result);
  })
  .catch(error => {
    console.log('–û—à–∏–±–∫–∞:', error.message);
  });
```

### –ü—Ä–∏–º–µ—Ä: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞

```javascript
function delay(ms) {
  return new Promise(resolve => {
    setTimeout(resolve, ms);
  });
}

delay(1000).then(() => {
  console.log('–ü—Ä–æ—à–ª–∞ 1 —Å–µ–∫—É–Ω–¥–∞');
});
```

### –¶–µ–ø–æ—á–∫–∏ Promise (chaining)

–ú–µ—Ç–æ–¥ `then` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π Promise, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å —Ü–µ–ø–æ—á–∫–∏:

```javascript
fetch('/api/user')
  .then(response => response.json())
  .then(user => fetch(`/api/orders/${user.id}`))
  .then(response => response.json())
  .then(orders => console.log(orders))
  .catch(error => console.log('–û—à–∏–±–∫–∞:', error));
```

### Promise vs Callback

```javascript
// ‚ùå Callback Hell
getUser(1, (user) => {
  getOrders(user.id, (orders) => {
    getDetails(orders[0].id, (details) => {
      console.log(details);
    });
  });
});

// ‚úÖ Promise Chain
getUser(1)
  .then(user => getOrders(user.id))
  .then(orders => getDetails(orders[0].id))
  .then(details => console.log(details))
  .catch(error => console.log(error));
```

### finally

–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ ‚Äî –∏ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ, –∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ:

```javascript
loadData()
  .then(data => console.log(data))
  .catch(error => console.log(error))
  .finally(() => {
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
    hideSpinner();
  });
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π Promise

```javascript
function checkNumber(num) {
  return new Promise((resolve, reject) => {
    if (num > 0) {
      resolve('–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ');
    } else {
      reject(new Error('–ß–∏—Å–ª–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º'));
    }
  });
}

checkNumber(5).then(msg => console.log(msg));  // "–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ"
checkNumber(-1).catch(err => console.log(err.message));  // "–ß–∏—Å–ª–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å..."
```

### –ü—Ä–∏–º–µ—Ä 2: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è

```javascript
function fetchUser(id) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      if (id > 0) {
        resolve({ id, name: 'User ' + id });
      } else {
        reject(new Error('Invalid ID'));
      }
    }, 500);
  });
}

fetchUser(1)
  .then(user => console.log(user))
  .catch(err => console.log(err.message));
```

### –ü—Ä–∏–º–µ—Ä 3: –¶–µ–ø–æ—á–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π

```javascript
function double(x) {
  return new Promise(resolve => {
    setTimeout(() => resolve(x * 2), 100);
  });
}

double(5)
  .then(result => double(result))  // 10
  .then(result => double(result))  // 20
  .then(result => console.log(result));  // 40
```

---

## ‚úèÔ∏è –ó–∞–¥–∞–Ω–∏–µ

### –û–ø–∏—Å–∞–Ω–∏–µ

–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `createPromise`, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞—ë—Ç Promise —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞: `shouldResolve` (boolean) –∏ `delay` (number, –º—Å)
2. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise
3. –ß–µ—Ä–µ–∑ `delay` –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥:
   - –ï—Å–ª–∏ `shouldResolve === true` ‚Äî resolve —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `'–£—Å–ø–µ—Ö'`
   - –ï—Å–ª–∏ `shouldResolve === false` ‚Äî reject —Å `new Error('–û—à–∏–±–∫–∞')`

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```javascript
createPromise(true, 100)
  .then(result => console.log(result))   // –ß–µ—Ä–µ–∑ 100–º—Å: "–£—Å–ø–µ—Ö"
  .catch(err => console.log(err.message));

createPromise(false, 200)
  .then(result => console.log(result))
  .catch(err => console.log(err.message));  // –ß–µ—Ä–µ–∑ 200–º—Å: "–û—à–∏–±–∫–∞"
```

---

## üí≠ –ü–æ–¥—Å–∫–∞–∑–∫–∏

<details>
<summary>–ü–æ–¥—Å–∫–∞–∑–∫–∞ 1: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</summary>

–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç Promise? –ö–∞–∫–∏–µ –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤–Ω—É—Ç—Ä–∏ –µ–≥–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –∏ –∑–∞ —á—Ç–æ –∫–∞–∂–¥–∞—è –æ—Ç–≤–µ—á–∞–µ—Ç? –ö–∞–∫ —Å–æ–≤–º–µ—Å—Ç–∏—Ç—å Promise —Å —Ç–∞–π–º–µ—Ä–æ–º, —á—Ç–æ–±—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏–ª—Å—è –Ω–µ —Å—Ä–∞–∑—É, –∞ —á–µ—Ä–µ–∑ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è?

</details>

<details>
<summary>–ü–æ–¥—Å–∫–∞–∑–∫–∞ 2: –°—Ç—Ä—É–∫—Ç—É—Ä–∞</summary>

–§—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å `new Promise(...)`. –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ Promise —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–≤—É–º —Ñ—É–Ω–∫—Ü–∏—è–º ‚Äî –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –∏ –Ω–µ—É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è. –°–æ–≤–º–µ—Å—Ç–∏—Ç–µ Promise —Å `setTimeout`, —á—Ç–æ–±—ã —Ä–µ—à–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—Ä–∏–Ω–∏–º–∞–ª–æ—Å—å –ø–æ—Å–ª–µ –∑–∞–¥–∞–Ω–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏.

</details>

<details>
<summary>–ü–æ–¥—Å–∫–∞–∑–∫–∞ 3: –ü–æ–¥—Ö–æ–¥</summary>

–°–æ–∑–¥–∞–π—Ç–µ Promise, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `setTimeout` —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π `delay`. –ö–æ–≥–¥–∞ —Ç–∞–π–º–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ `shouldResolve`. –ü—Ä–∏ `true` –∑–∞–≤–µ—Ä—à–∏—Ç–µ Promise —É—Å–ø–µ—à–Ω–æ, –ø–µ—Ä–µ–¥–∞–≤ —Å—Ç—Ä–æ–∫—É-—Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü—Ä–∏ `false` –∑–∞–≤–µ—Ä—à–∏—Ç–µ Promise —Å –æ—à–∏–±–∫–æ–π, —Å–æ–∑–¥–∞–≤ –æ–±—ä–µ–∫—Ç `Error` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª ¬´–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è¬ª ‚Äî —Ç–∞–º –≤–∏–¥–Ω–æ, –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ —Å—Ç—Ä–æ–∫–∏ –æ–∂–∏–¥–∞—é—Ç—Å—è –ø—Ä–∏ resolve –∏ reject.

</details>

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ

```bash
npx vitest module-15/index.spec.js
```

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [MDN: Promise](https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Promise)
- [JavaScript.info: Promise](https://learn.javascript.ru/promise-basics)

---

## ‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ß–µ–º Promise –ª—É—á—à–µ callback?**

A: Promise –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å –ø–ª–æ—Å–∫–∏–π –∫–æ–¥ –≤–º–µ—Å—Ç–æ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ. –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ —á–µ—Ä–µ–∑ `.catch()`.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å Promise?**

A: –ù–µ—Ç, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Promise –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç AbortController –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

**Q: –ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –≤—ã–∑–≤–∞—Ç—å resolve() –¥–≤–∞–∂–¥—ã?**

A: –ù–∏—á–µ–≥–æ ‚Äî Promise –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑. –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.

---

## üéì –ß—Ç–æ –¥–∞–ª—å—à–µ?

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ **–ú–æ–¥—É–ª—å 16: async/await** ‚Äî –±–æ–ª–µ–µ —É–¥–æ–±–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Promises.
