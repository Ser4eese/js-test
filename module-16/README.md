# –ú–æ–¥—É–ª—å 16: async/await

## üéØ –¶–µ–ª—å –º–æ–¥—É–ª—è

–ù–∞—É—á–∏—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å async/await ‚Äî —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Promises, –¥–µ–ª–∞—é—â–∏–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –ø–æ—Ö–æ–∂–∏–º –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π.

---

## üìö –¢–µ–æ—Ä–∏—è

### –ß—Ç–æ —Ç–∞–∫–æ–µ async/await?

**async/await** ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –ø–∏—Å–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ —Ç–∞–∫, –±—É–¥—Ç–æ –æ–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π. –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º —ç—Ç–æ –≤—Å—ë —Ç–µ –∂–µ Promises, –Ω–æ —á–∏—Ç–∞—Ç—å –∏ –ø–∏—Å–∞—Ç—å —Ç–∞–∫–æ–π –∫–æ–¥ –Ω–∞–º–Ω–æ–≥–æ –ø—Ä–æ—â–µ.

### async —Ñ—É–Ω–∫—Ü–∏—è

–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `async` –ø–µ—Ä–µ–¥ —Ñ—É–Ω–∫—Ü–∏–µ–π –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise:

```javascript
async function greet() {
  return '–ü—Ä–∏–≤–µ—Ç';
}

// –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ:
function greet() {
  return Promise.resolve('–ü—Ä–∏–≤–µ—Ç');
}

greet().then(msg => console.log(msg)); // "–ü—Ä–∏–≤–µ—Ç"
```

### await

`await` –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ async-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ Promise –Ω–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—Å—è:

```javascript
async function getData() {
  const result = await somePromise;  // –ñ–¥—ë–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  console.log(result);               // –†–∞–±–æ—Ç–∞–µ–º —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
}
```

**–í–∞–∂–Ω–æ:** `await` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ `async` —Ñ—É–Ω–∫—Ü–∏–∏.

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: then vs await

```javascript
// –° then (—Ü–µ–ø–æ—á–∫–∞)
function loadUser() {
  return fetch('/api/user')
    .then(response => response.json())
    .then(user => {
      console.log(user);
      return user;
    });
}

// –° async/await (–ª–∏–Ω–µ–π–Ω—ã–π –∫–æ–¥)
async function loadUser() {
  const response = await fetch('/api/user');
  const user = await response.json();
  console.log(user);
  return user;
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: try/catch

```javascript
async function loadData() {
  try {
    const response = await fetch('/api/data');
    const data = await response.json();
    return data;
  } catch (error) {
    console.log('–û—à–∏–±–∫–∞:', error.message);
    return null;
  }
}
```

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ vs –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

```javascript
// ‚ùå –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (–º–µ–¥–ª–µ–Ω–Ω–æ)
async function loadAll() {
  const user = await fetchUser();     // –ñ–¥—ë–º
  const posts = await fetchPosts();   // –ü–æ—Ç–æ–º –∂–¥—ë–º
  const comments = await fetchComments(); // –ü–æ—Ç–æ–º –∂–¥—ë–º
}

// ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (–±—ã—Å—Ç—Ä–æ)
async function loadAll() {
  const [user, posts, comments] = await Promise.all([
    fetchUser(),
    fetchPosts(),
    fetchComments()
  ]);
}
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–∞—è async —Ñ—É–Ω–∫—Ü–∏—è

```javascript
function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function countdown() {
  console.log('3...');
  await delay(1000);
  console.log('2...');
  await delay(1000);
  console.log('1...');
  await delay(1000);
  console.log('–ü–æ–µ—Ö–∞–ª–∏!');
}

countdown();
```

### –ü—Ä–∏–º–µ—Ä 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```javascript
async function divide(a, b) {
  if (b === 0) {
    throw new Error('–î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å');
  }
  return a / b;
}

async function calculate() {
  try {
    const result = await divide(10, 0);
    console.log(result);
  } catch (error) {
    console.log('–û—à–∏–±–∫–∞:', error.message);
  }
}

calculate(); // "–û—à–∏–±–∫–∞: –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å"
```

### –ü—Ä–∏–º–µ—Ä 3: –¶–µ–ø–æ—á–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

```javascript
async function processUser(id) {
  const user = await getUser(id);
  const orders = await getOrders(user.id);
  const total = orders.reduce((sum, o) => sum + o.amount, 0);
  return { user, total };
}
```

---

## ‚úèÔ∏è –ó–∞–¥–∞–Ω–∏–µ

### –û–ø–∏—Å–∞–Ω–∏–µ

–ù–∞–ø–∏—à–∏—Ç–µ async-—Ñ—É–Ω–∫—Ü–∏—é `fetchSequential`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –º–∞—Å—Å–∏–≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ —Å–æ–±–∏—Ä–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Ñ—É–Ω–∫—Ü–∏–π, –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise
2. –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ** (–æ–¥–Ω–∞ –∑–∞ –¥—Ä—É–≥–æ–π)
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise —Å –º–∞—Å—Å–∏–≤–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
4. –ï—Å–ª–∏ –∫–∞–∫–∞—è-—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É ‚Äî –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç –µ—ë –¥–∞–ª—å—à–µ

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```javascript
const task1 = () => Promise.resolve(1);
const task2 = () => Promise.resolve(2);
const task3 = () => Promise.resolve(3);

const results = await fetchSequential([task1, task2, task3]);
console.log(results); // [1, 2, 3]

// –° –æ—à–∏–±–∫–æ–π
const failing = () => Promise.reject(new Error('–£–ø—Å'));
await fetchSequential([task1, failing, task3]); // –í—ã–±—Ä–æ—Å–∏—Ç –æ—à–∏–±–∫—É "–£–ø—Å"
```

---

## üí≠ –ü–æ–¥—Å–∫–∞–∑–∫–∏

<details>
<summary>–ü–æ–¥—Å–∫–∞–∑–∫–∞ 1: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</summary>

–ü–æ—á–µ–º—É `forEach` –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π? –ö–∞–∫–æ–π —Ü–∏–∫–ª –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `await` –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è? –ö–∞–∫ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –º–∞—Å—Å–∏–≤?

</details>

<details>
<summary>–ü–æ–¥—Å–∫–∞–∑–∫–∞ 2: –°—Ç—Ä—É–∫—Ç—É—Ä–∞</summary>

–û–±—ä—è–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é —Å –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–æ–º `async`. –í–Ω—É—Ç—Ä–∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –ø–µ—Ä–µ–±–µ—Ä–∏—Ç–µ –≤—Ö–æ–¥–Ω–æ–π –º–∞—Å—Å–∏–≤ –∑–∞–¥–∞—á –≤ —Ü–∏–∫–ª–µ. –ü–æ–º–Ω–∏—Ç–µ, —á—Ç–æ `forEach` –Ω–µ —É–º–µ–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å `await` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ç–∏–ø —Ü–∏–∫–ª–∞.

</details>

<details>
<summary>–ü–æ–¥—Å–∫–∞–∑–∫–∞ 3: –ü–æ–¥—Ö–æ–¥</summary>

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ü–∏–∫–ª `for...of` –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞ –º–∞—Å—Å–∏–≤–∞ `tasks`. –ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è Promise. –í—ã–∑–æ–≤–∏—Ç–µ –µ—ë –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —á–µ—Ä–µ–∑ `await`, –∑–∞—Ç–µ–º –¥–æ–±–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –º–∞—Å—Å–∏–≤. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞ –≤–µ—Ä–Ω–∏—Ç–µ –º–∞—Å—Å–∏–≤. –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —è–≤–Ω–æ –ø–∏—Å–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ ‚Äî `async`-—Ñ—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–±—Ä–æ—Å–∏—Ç –ª—é–±—É—é –æ—à–∏–±–∫—É –∏–∑ `await` –∫–∞–∫ rejected Promise.

</details>

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ

```bash
npx vitest module-16/index.spec.js
```

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [MDN: async function](https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Statements/async_function)
- [JavaScript.info: async/await](https://learn.javascript.ru/async-await)

---

## ‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å await –±–µ–∑ async?**

A: –¢–æ–ª—å–∫–æ –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è (top-level await –≤ ES modules). –í –æ–±—ã—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö ‚Äî –Ω–µ–ª—å–∑—è.

**Q: –ß–µ–º async/await –ª—É—á—à–µ then/catch?**

A: –ö–æ–¥ —á–∏—Ç–∞–µ—Ç—Å—è –ª–∏–Ω–µ–π–Ω–æ, –∫–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π. –õ–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å. –û—à–∏–±–∫–∏ –ª–æ–≤—è—Ç—Å—è —á–µ—Ä–µ–∑ –ø—Ä–∏–≤—ã—á–Ω—ã–π try/catch.

**Q: –ü–æ—á–µ–º—É forEach —Å await –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

A: forEach –Ω–µ –∂–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `for...of` –∏–ª–∏ `for` –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

**Q: –ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ await –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ?**

A: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Promise.all([promise1, promise2, ...])`.

---

## üéì –ß—Ç–æ –¥–∞–ª—å—à–µ?

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ **–ú–æ–¥—É–ª—å 17: HTML** ‚Äî –Ω–∞—á–Ω—ë—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã.
