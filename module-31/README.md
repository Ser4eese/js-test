# –ú–æ–¥—É–ª—å 31: React + Fetch (–ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)

## üéØ –¶–µ–ª—å –º–æ–¥—É–ª—è

–ù–∞—É—á–∏—Ç—å—Å—è –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ –≤ React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ useEffect –∏ fetch.

---

## üìö –¢–µ–æ—Ä–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –∫–æ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ?

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ**, –∞ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç **–ø–æ–∑–∂–µ**. –ù—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º:

```
1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è ‚Üí "–ó–∞–≥—Ä—É–∑–∫–∞..."
2. useEffect ‚Üí fetch('/api/data')
3. –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã ‚Üí setState ‚Üí –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä
4. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
```

### useEffect

–í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–¥ **–ø–æ—Å–ª–µ** —Ä–µ–Ω–¥–µ—Ä–∞:

```jsx
import { useState, useEffect } from 'react';

function UserList() {
  const [users, setUsers] = useState([]);

  useEffect(() => {
    // –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∞
    fetch('/api/users')
      .then(res => res.json())
      .then(data => setUsers(data));
  }, []); // [] ‚Äî —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

  return (
    <ul>
      {users.map(u => <li key={u.id}>{u.name}</li>)}
    </ul>
  );
}
```

### –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏

```jsx
function UserList() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    fetch('/api/users')
      .then(res => {
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return res.json();
      })
      .then(data => {
        setUsers(data);
        setLoading(false);
      })
      .catch(err => {
        setError(err.message);
        setLoading(false);
      });
  }, []);

  if (loading) return <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>;
  if (error) return <p>–û—à–∏–±–∫–∞: {error}</p>;

  return (
    <ul>
      {users.map(u => <li key={u.id}>{u.name}</li>)}
    </ul>
  );
}
```

### –§–æ—Ä–º–∞ + POST –∑–∞–ø—Ä–æ—Å

```jsx
function AddUser() {
  const [name, setName] = useState('');

  async function handleSubmit(e) {
    e.preventDefault();

    await fetch('/api/users', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name })
    });

    setName(''); // –û—á–∏—Å—Ç–∏—Ç—å
  }

  return (
    <form onSubmit={handleSubmit}>
      <input
        value={name}
        onChange={(e) => setName(e.target.value)}
        placeholder="–ò–º—è"
      />
      <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>
  );
}
```

### async/await –≤ useEffect

```jsx
useEffect(() => {
  // –ù–µ–ª—å–∑—è: useEffect(() => async ...)
  // –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å async —Ñ—É–Ω–∫—Ü–∏—é –≤–Ω—É—Ç—Ä–∏:

  async function loadData() {
    const res = await fetch('/api/data');
    const data = await res.json();
    setData(data);
  }

  loadData();
}, []);
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ó–∞–≥—Ä—É–∑–∫–∞ –æ–¥–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞

```jsx
function Post({ postId }) {
  const [post, setPost] = useState(null);

  useEffect(() => {
    fetch(`/api/posts/${postId}`)
      .then(res => res.json())
      .then(setPost);
  }, [postId]); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ postId

  if (!post) return <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>;

  return (
    <article>
      <h2>{post.title}</h2>
      <p>{post.body}</p>
    </article>
  );
}
```

### –ü—Ä–∏–º–µ—Ä 2: –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞

```jsx
function TodoApp() {
  const [todos, setTodos] = useState([]);

  useEffect(() => {
    fetch('/api/todos')
      .then(res => res.json())
      .then(setTodos);
  }, []);

  async function handleDelete(id) {
    await fetch(`/api/todos/${id}`, { method: 'DELETE' });
    setTodos(todos.filter(t => t.id !== id));
  }

  return (
    <ul>
      {todos.map(todo => (
        <li key={todo.id}>
          {todo.title}
          <button onClick={() => handleDelete(todo.id)}>√ó</button>
        </li>
      ))}
    </ul>
  );
}
```

---

## ‚úèÔ∏è –ó–∞–¥–∞–Ω–∏–µ

### –û–ø–∏—Å–∞–Ω–∏–µ

–°–æ–∑–¥–∞–π—Ç–µ –¥–≤–∞ React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å API:

1. `PostList` ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤
2. `AddPostForm` ‚Äî —Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. `PostList({ url })`:
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `url` ‚Äî –±–∞–∑–æ–≤—ã–π URL –¥–ª—è API
   - –ü—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç `GET {url}/api/posts`
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
     - –ó–∞–≥—Ä—É–∑–∫–∞: `<p data-testid="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>`
     - –û—à–∏–±–∫–∞: `<p data-testid="error">–û—à–∏–±–∫–∞: {message}</p>`
     - –î–∞–Ω–Ω—ã–µ: `<ul data-testid="posts">` —Å `<li>` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞
   - –ö–∞–∂–¥—ã–π `<li>` —Å–æ–¥–µ—Ä–∂–∏—Ç `post.title`

2. `AddPostForm({ url, onAdd })`:
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `url` –∏ –∫–æ–ª–±—ç–∫ `onAdd`
   - –°–æ–¥–µ—Ä–∂–∏—Ç `<input>` —Å `placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞"`
   - –°–æ–¥–µ—Ä–∂–∏—Ç `<button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>`
   - –ü—Ä–∏ —Å–∞–±–º–∏—Ç–µ:
     - POST `{url}/api/posts` —Å body `{ title }`
     - –í—ã–∑—ã–≤–∞–µ—Ç `onAdd(newPost)` —Å –æ—Ç–≤–µ—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–∞
     - –û—á–∏—â–∞–µ—Ç input

### –ü—Ä–∏–º–µ—Ä—ã

```jsx
<PostList url="http://localhost:3000" />
// 1. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ó–∞–≥—Ä—É–∑–∫–∞..."
// 2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç GET http://localhost:3000/api/posts
// 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤

<AddPostForm
  url="http://localhost:3000"
  onAdd={(post) => console.log('–°–æ–∑–¥–∞–Ω:', post)}
/>
// –§–æ—Ä–º–∞ —Å input –∏ –∫–Ω–æ–ø–∫–æ–π
// –ü—Ä–∏ —Å–∞–±–º–∏—Ç–µ ‚Äî POST –∑–∞–ø—Ä–æ—Å + –∫–æ–ª–±—ç–∫
```

---

## üí≠ –ü–æ–¥—Å–∫–∞–∑–∫–∏

<details>
<summary>–ü–æ–¥—Å–∫–∞–∑–∫–∞ 1: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</summary>

–î–ª—è `PostList` –≤–∞–º –Ω—É–∂–Ω—ã —Ç—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è: –¥–∞–Ω–Ω—ã–µ, –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—à–∏–±–∫–∞. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ `useEffect` –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞. –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ HTTP-–æ—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω—ã–π, –ø—Ä–µ–∂–¥–µ —á–µ–º –≤—ã–∑–≤–∞—Ç—å `.json()`?
</details>

<details>
<summary>–ü–æ–¥—Å–∫–∞–∑–∫–∞ 2: –°—Ç—Ä—É–∫—Ç—É—Ä–∞</summary>

`PostList` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è: –º–∞—Å—Å–∏–≤ –ø–æ—Å—Ç–æ–≤, —Ñ–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Å—Ç—Ä–æ–∫—É –æ—à–∏–±–∫–∏. –í `useEffect` (—Å –º–∞—Å—Å–∏–≤–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è fetch. –ü–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `.json()` –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ `res.ok` ‚Äî –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ—É—Å–ø–µ—à–Ω—ã–π, –±—Ä–æ—Å–∞–π—Ç–µ –æ—à–∏–±–∫—É. –í `.then` –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≤ `.catch` ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è: –∑–∞–≥—Ä—É–∑–∫–∞, –æ—à–∏–±–∫–∞ –∏–ª–∏ —Å–ø–∏—Å–æ–∫.

`AddPostForm` ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π input —Å–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –¥–ª—è —Ç–µ–∫—Å—Ç–∞. –ü—Ä–∏ submit ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ POST-–∑–∞–ø—Ä–æ—Å–∞ –∏ –≤—ã–∑–æ–≤ –∫–æ–ª–±—ç–∫–∞.

</details>

<details>
<summary>–ü–æ–¥—Å–∫–∞–∑–∫–∞ 3: –ü–æ–¥—Ö–æ–¥</summary>

`PostList`: —Å–æ–∑–¥–∞–π—Ç–µ —Ç—Ä–∏ `useState` ‚Äî –¥–ª—è –ø–æ—Å—Ç–æ–≤ (–Ω–∞—á–∞–ª—å–Ω–æ `[]`), –∑–∞–≥—Ä—É–∑–∫–∏ (–Ω–∞—á–∞–ª—å–Ω–æ `true`) –∏ –æ—à–∏–±–∫–∏ (–Ω–∞—á–∞–ª—å–Ω–æ `null`). –í `useEffect` —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é `[url]` –¥–µ–ª–∞–π—Ç–µ fetch –Ω–∞ `{url}/api/posts`. –í —Ü–µ–ø–æ—á–∫–µ –ø—Ä–æ–º–∏—Å–æ–≤: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `res.ok`, –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –±—Ä–æ—Å—å—Ç–µ `new Error` —Å —Ç–µ–∫—Å—Ç–æ–º –≤—Ä–æ–¥–µ `HTTP {status}`. –ü—Ä–∏ —É—Å–ø–µ—Ö–µ ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–æ—Å—Ç—ã –∏ —Å–±—Ä–æ—Å—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É –≤ `false`. –í catch ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ—à–∏–±–∫—É –∏ —Å–±—Ä–æ—Å—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É. –ü—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ: –µ—Å–ª–∏ `loading` ‚Äî –≤–µ—Ä–Ω–∏—Ç–µ `<p>` —Å data-testid="loading" –∏ —Ç–µ–∫—Å—Ç–æ–º "–ó–∞–≥—Ä—É–∑–∫–∞...". –ï—Å–ª–∏ `error` ‚Äî `<p>` —Å data-testid="error" –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ–º. –ò–Ω–∞—á–µ ‚Äî `<ul>` —Å data-testid="posts", –≥–¥–µ –∫–∞–∂–¥—ã–π –ø–æ—Å—Ç –º–∞–ø–ø–∏—Ç—Å—è –≤ `<li>` —Å `key` –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º.

`AddPostForm`: —Ö—Ä–∞–Ω–∏—Ç–µ –≤–≤–µ–¥—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ `useState`. –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã ‚Äî `preventDefault`, —Å–¥–µ–ª–∞–π—Ç–µ POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ `{url}/api/posts` —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `Content-Type: application/json` –∏ —Ç–µ–ª–æ–º —Å –ø–æ–ª–µ–º `title`. –ü–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç, —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç–µ JSON –∏ –ø–µ—Ä–µ–¥–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–æ–ª–±—ç–∫ `onAdd`. –û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–ª–µ –≤–≤–æ–¥–∞, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É.

</details>

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ

```bash
npx vitest module-31/index.spec.jsx
```

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [React: useEffect](https://react.dev/reference/react/useEffect)
- [React: Synchronizing with Effects](https://react.dev/learn/synchronizing-with-effects)

---

## ‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è —Å–¥–µ–ª–∞—Ç—å useEffect async?**

A: useEffect –æ–∂–∏–¥–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é (–∏–ª–∏ undefined), –∞ async –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise. –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å async —Ñ—É–Ω–∫—Ü–∏—é –≤–Ω—É—Ç—Ä–∏.

**Q: –ó–∞—á–µ–º –º–∞—Å—Å–∏–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π `[]`?**

A: `[]` ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑. –ë–µ–∑ `[]` ‚Äî –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ. `[id]` ‚Äî –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ id.

**Q: –ö–∞–∫ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏?**

A: –ß–µ—Ä–µ–∑ `AbortController`. –í —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª—è—Ö –ø–æ–∫–∞ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.

---

## üéì –ß—Ç–æ –¥–∞–ª—å—à–µ?

–ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ **–ú–æ–¥—É–ª—å 32: –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç** ‚Äî —Å–æ–±–µ—Ä—ë—Ç–µ –≤—Å—ë –≤–º–µ—Å—Ç–µ!
