# –ú–æ–¥—É–ª—å 13: Callbacks

## üéØ –¶–µ–ª—å –º–æ–¥—É–ª—è

–ü–æ–Ω—è—Ç—å, —á—Ç–æ —Ç–∞–∫–æ–µ callback-—Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∫–∞–∫ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

---

## üìö –¢–µ–æ—Ä–∏—è

### –ß—Ç–æ —Ç–∞–∫–æ–µ callback?

**Callback** (–æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤) ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –¥—Ä—É–≥—É—é —Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–∑–∂–µ.

```javascript
function greet(name, callback) {
  const message = `–ü—Ä–∏–≤–µ—Ç, ${name}!`;
  callback(message);
}

greet('–ò–≤–∞–Ω', function(msg) {
  console.log(msg); // "–ü—Ä–∏–≤–µ—Ç, –ò–≤–∞–Ω!"
});
```

### –ó–∞—á–µ–º –Ω—É–∂–Ω—ã callbacks?

1. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–¥ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏
2. **–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è** ‚Äî –ø–µ—Ä–µ–¥–∞—Ç—å —Å–≤–æ—ë –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π** ‚Äî —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ callbacks

–í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É, –≤ –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞:

```javascript
const numbers = [1, 2, 3];

// forEach –ø—Ä–∏–Ω–∏–º–∞–µ—Ç callback –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –µ–≥–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
numbers.forEach(function(num) {
  console.log(num * 2);
});
// 2, 4, 6
```

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ callbacks

–í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ–∑–∂–µ, –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏:

```javascript
console.log('–ù–∞—á–∞–ª–æ');

setTimeout(function() {
  console.log('–ü—Ä–æ—à–ª–∞ 1 —Å–µ–∫—É–Ω–¥–∞');
}, 1000);

console.log('–ö–æ–Ω–µ—Ü');

// –í—ã–≤–æ–¥:
// –ù–∞—á–∞–ª–æ
// –ö–æ–Ω–µ—Ü
// –ü—Ä–æ—à–ª–∞ 1 —Å–µ–∫—É–Ω–¥–∞
```

### Error-first callback (Node.js —Å—Ç–∏–ª—å)

–í Node.js –ø—Ä–∏–Ω—è—Ç–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –æ—à–∏–±–∫—É –ø–µ—Ä–≤—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º:

```javascript
function readFile(path, callback) {
  // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Äî –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç
  // –ï—Å–ª–∏ —É—Å–ø–µ—Ö ‚Äî –≤—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç

  if (!path) {
    callback(new Error('–ü—É—Ç—å –Ω–µ —É–∫–∞–∑–∞–Ω'), null);
    return;
  }

  callback(null, '—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞');
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
readFile('/data.txt', function(error, data) {
  if (error) {
    console.log('–û—à–∏–±–∫–∞:', error.message);
    return;
  }
  console.log('–î–∞–Ω–Ω—ã–µ:', data);
});
```

### Callback Hell (–ø—Ä–æ–±–ª–µ–º–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏)

–ö–æ–≥–¥–∞ –º–Ω–æ–≥–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ–¥—Ä—è–¥ ‚Äî –∫–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ—á–∏—Ç–∞–µ–º—ã–º:

```javascript
// ‚ùå –ü–ª–æ—Ö–æ ‚Äî "–ø–∏—Ä–∞–º–∏–¥–∞ —Å–º–µ—Ä—Ç–∏"
getUser(1, function(user) {
  getOrders(user.id, function(orders) {
    getOrderDetails(orders[0].id, function(details) {
      console.log(details);
    });
  });
});
```

–≠—Ç—É –ø—Ä–æ–±–ª–µ–º—É —Ä–µ—à–∞—é—Ç **Promises** (—Å–ª–µ–¥—É—é—â–∏–π –º–æ–¥—É–ª—å).

---

## üí° –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π callback

```javascript
function calculate(a, b, operation) {
  return operation(a, b);
}

const sum = calculate(5, 3, function(x, y) {
  return x + y;
});
console.log(sum); // 8

const product = calculate(5, 3, (x, y) => x * y);
console.log(product); // 15
```

### –ü—Ä–∏–º–µ—Ä 2: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π callback

```javascript
function fetchUser(id, onSuccess, onError) {
  setTimeout(() => {
    if (id <= 0) {
      onError(new Error('–ù–µ–≤–µ—Ä–Ω—ã–π ID'));
      return;
    }
    onSuccess({ id, name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ' + id });
  }, 500);
}

fetchUser(1,
  user => console.log('–£—Å–ø–µ—Ö:', user),
  err => console.log('–û—à–∏–±–∫–∞:', err.message)
);
```

### –ü—Ä–∏–º–µ—Ä 3: –°–≤–æ—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è forEach

```javascript
function myForEach(arr, callback) {
  for (let i = 0; i < arr.length; i++) {
    callback(arr[i], i, arr);
  }
}

myForEach([10, 20, 30], function(item, index) {
  console.log(`–≠–ª–µ–º–µ–Ω—Ç ${index}: ${item}`);
});
```

---

## ‚úèÔ∏è –ó–∞–¥–∞–Ω–∏–µ

### –û–ø–∏—Å–∞–Ω–∏–µ

–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `asyncOperation`, –∫–æ—Ç–æ—Ä–∞—è —Å–∏–º—É–ª–∏—Ä—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é —Å callback –≤ —Å—Ç–∏–ª–µ Node.js (error-first).

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞: `shouldSucceed` (boolean) –∏ `callback` (function)
2. –ß–µ—Ä–µ–∑ 100–º—Å –≤—ã–∑—ã–≤–∞–µ—Ç callback
3. –ï—Å–ª–∏ `shouldSucceed === true` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç `callback(null, '–û–ø–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞')`
4. –ï—Å–ª–∏ `shouldSucceed === false` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç `callback(new Error('–û–ø–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å'), null)`

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```javascript
asyncOperation(true, function(error, result) {
  if (error) {
    console.log('–û—à–∏–±–∫–∞:', error.message);
    return;
  }
  console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', result);
});
// –ß–µ—Ä–µ–∑ 100–º—Å: "–†–µ–∑—É–ª—å—Ç–∞—Ç: –û–ø–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞"

asyncOperation(false, function(error, result) {
  if (error) {
    console.log('–û—à–∏–±–∫–∞:', error.message);
    return;
  }
  console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', result);
});
// –ß–µ—Ä–µ–∑ 100–º—Å: "–û—à–∏–±–∫–∞: –û–ø–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å"
```

---

## üí≠ –ü–æ–¥—Å–∫–∞–∑–∫–∏

<details>
<summary>–ü–æ–¥—Å–∫–∞–∑–∫–∞ 1: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</summary>

–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã callback –≤—ã–∑—ã–≤–∞–ª—Å—è –Ω–µ —Å—Ä–∞–∑—É, –∞ —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è? –ö–∞–∫–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω –≤ Node.js –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ callback ‚Äî —á—Ç–æ –∏–¥—ë—Ç –ø–µ—Ä–≤—ã–º: –æ—à–∏–±–∫–∞ –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç?

</details>

<details>
<summary>–ü–æ–¥—Å–∫–∞–∑–∫–∞ 2: –°—Ç—Ä—É–∫—Ç—É—Ä–∞</summary>

–í–∞–º –Ω—É–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å –ª–æ–≥–∏–∫—É –≤ `setTimeout`, —á—Ç–æ–±—ã callback –≤—ã–∑—ã–≤–∞–ª—Å—è –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π. –í–Ω—É—Ç—Ä–∏ —Ç–∞–π–º–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—Å–ª–æ–≤–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ `shouldSucceed` –∏ –≤—ã–∑—ã–≤–∞–π—Ç–µ callback –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É error-first: –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –æ—à–∏–±–∫–∞ (–∏–ª–∏ `null`), –≤—Ç–æ—Ä–æ–π ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–∏–ª–∏ `null`).

</details>

<details>
<summary>–ü–æ–¥—Å–∫–∞–∑–∫–∞ 3: –ü–æ–¥—Ö–æ–¥</summary>

–§—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å `setTimeout` —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 100 –º—Å. –í–Ω—É—Ç—Ä–∏ —Ç–∞–π–º–µ—Ä–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ `shouldSucceed`. –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—ã–∑–æ–≤–∏—Ç–µ callback —Å –¥–≤—É–º—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –≤ —Å—Ç–∏–ª–µ error-first: –ø—Ä–∏ —É—Å–ø–µ—Ö–µ –æ—à–∏–±–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–ø–µ—Ä–µ–¥–∞–π—Ç–µ `null`), –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî —Å—Ç—Ä–æ–∫–∞. –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ –ø–µ—Ä–µ–¥–∞–π—Ç–µ –æ–±—ä–µ–∫—Ç `Error` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º, –∞ –≤–º–µ—Å—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚Äî `null`. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª ¬´–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è¬ª, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ —Å—Ç—Ä–æ–∫–∏ –æ–∂–∏–¥–∞—é—Ç—Å—è.

</details>

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ

```bash
npx vitest module-13/index.spec.js
```

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [MDN: Callback function](https://developer.mozilla.org/ru/docs/Glossary/Callback_function)
- [JavaScript.info: Callbacks](https://learn.javascript.ru/callbacks)

---

## ‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ß–µ–º callback –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ–±—ã—á–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏?**

A: –ù–∏—á–µ–º. Callback ‚Äî —ç—Ç–æ –æ–±—ã—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–∞—è –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç –≤ –¥—Ä—É–≥—É—é —Ñ—É–Ω–∫—Ü–∏—é.

**Q: –ü–æ—á–µ–º—É –æ—à–∏–±–∫–∞ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ø–µ—Ä–≤—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º?**

A: –≠—Ç–æ –∫–æ–Ω–≤–µ–Ω—Ü–∏—è Node.js. –¢–∞–∫ –ª–µ–≥–∫–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å: `if (error) { ... }`. –ï—Å–ª–∏ –æ—à–∏–±–∫–∏ –Ω–µ—Ç ‚Äî –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç `null`.

**Q: –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å callbacks, –∞ –∫–æ–≥–¥–∞ Promises?**

A: –°–µ–π—á–∞—Å —á–∞—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Promises –∏ async/await. Callbacks –æ—Å—Ç–∞–ª–∏—Å—å –≤ —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö API (–Ω–∞–ø—Ä–∏–º–µ—Ä, `setTimeout`).

---

## üéì –ß—Ç–æ –¥–∞–ª—å—à–µ?

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ **–ú–æ–¥—É–ª—å 14: Event Loop –∏ setTimeout** ‚Äî —É–∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ JavaScript –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥.
